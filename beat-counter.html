<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Beat Counter & Marker</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 40px;
      background: #18181b;
      color: #f3f4f6;
      min-height: 100vh;
    }
    input, button, textarea {
      padding: 10px;
      font-size: 16px;
      margin: 10px;
      background: #23232a;
      color: #f3f4f6;
      border: 1.5px solid #33374d;
      border-radius: 7px;
      outline: none;
      transition: border 0.2s, background 0.2s;
    }
    input:focus, textarea:focus {
      border-color: #38bdf8;
      background: #232a36;
    }
    button {
      background: #23232a;
      color: #f3f4f6;
      border: 1.5px solid #38bdf8;
      cursor: pointer;
      border-radius: 7px;
      transition: background 0.2s, color 0.2s, border 0.2s;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    button:not(:disabled):hover {
      background: #38bdf8;
      color: #18181b;
      border-color: #38bdf8;
    }
    #output {
      font-size: 24px;
      margin-top: 20px;
      color: #38bdf8;
    }
    textarea {
      width: 300px;
      height: 150px;
      resize: vertical;
      background: #23232a;
      color: #f3f4f6;
      border: 1.5px solid #33374d;
    }
    h1, h3 {
      color: #f3f4f6;
    }
    .beat-box {
      min-width:32px; min-height:32px; display:flex; align-items:center; justify-content:center;
      border-radius:7px; background:#23232a; color:#38bdf8; font-weight:bold; font-size:16px;
      border:2px solid #38bdf8; transition:background 0.2s, color 0.2s, border 0.2s;
    }
    .beat-box.active {
      background: #22c55e !important;
      color: #fff !important;
      border-color: #22c55e !important;
    }
    .beat-box.passed {
      opacity: 0.5;
      color: #64748b !important;
      border-color: #334155 !important;
      background: #18181b !important;
    }
  </style>
</head>
<body>
  <h1>üéµ Beat Counter & Marker</h1>


  <div style="margin-bottom:18px">
    <label for="bpmInput" style="font-size:15px;">BPM:</label>
    <input type="number" id="bpmInput" placeholder="Masukkan BPM" min="1" autofocus />
    <label for="audioFile" style="font-size:15px;">Audio:</label>
    <input type="file" id="audioFile" accept="audio/*" />
  </div>
  <audio id="audioPlayer" controls style="margin-bottom:18px;"></audio>

  <div id="output">Beat: 0</div>

  <button id="markBtn" disabled style="margin-bottom:10px;">üìç Tandai Beat Ini</button>

  <div id="notif" style="color:#38bdf8; font-size:15px; min-height:22px;"></div>
  <button id="exportBtn" style="margin-bottom:18px; margin-left:8px;">‚¨áÔ∏è Export JSON</button>


  <h3 style="margin-top:18px;">üìã Daftar Beat Tertandai</h3>
  <div id="beatBoxes" style="display:flex; flex-wrap:wrap; gap:8px; justify-content:center; min-height:40px; margin-bottom:10px;"></div>

  <script>
    const audio = document.getElementById('audioPlayer');
    const bpmInput = document.getElementById('bpmInput');
    const fileInput = document.getElementById('audioFile');
    const output = document.getElementById('output');
    const beatBoxes = document.getElementById('beatBoxes');
    const markBtn = document.getElementById('markBtn');

    const notif = document.getElementById('notif');
    const exportBtn = document.getElementById('exportBtn');
    exportBtn.addEventListener('click', () => {
      if (markedBeats.length === 0) {
        notif.textContent = 'Belum ada beat yang bisa diexport!';
        setTimeout(() => notif.textContent = '', 1200);
        return;
      }
      const data = JSON.stringify({ beats: markedBeats }, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'beat-marked.json';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 100);
    });


    let interval;
    let currentBeat = 0;
    let markedBeats = [];


    function renderBeatBoxes() {
      beatBoxes.innerHTML = '';
      if (markedBeats.length === 0) {
        beatBoxes.innerHTML = '<span style="color:#aaa;">Belum ada beat tertandai...</span>';
        return;
      }
      markedBeats.forEach(beat => {
        const box = document.createElement('div');
        box.textContent = beat;
        box.className = 'beat-box';
        if (Number(beat) === currentBeat) {
          box.classList.add('active');
        } else if (Number(beat) < currentBeat) {
          box.classList.add('passed');
        }
        beatBoxes.appendChild(box);
      });
    }

    function updateBeat() {
      const bpm = parseFloat(bpmInput.value);
      if (isNaN(bpm) || bpm <= 0 || audio.paused) return;

      const currentTime = audio.currentTime;
      currentBeat = Math.floor(currentTime * bpm / 60) + 1;
      output.textContent = `Beat: ${currentBeat}`;
      renderBeatBoxes();
    }

    function updateMarkBtnState() {
      const bpm = parseFloat(bpmInput.value);
      markBtn.disabled = isNaN(bpm) || bpm <= 0 || audio.paused || audio.currentTime === 0;
    }

    fileInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        audio.src = url;
      }
    });

    bpmInput.addEventListener('input', updateMarkBtnState);
    audio.addEventListener('play', () => {
      clearInterval(interval);
      interval = setInterval(() => {
        updateBeat();
        updateMarkBtnState();
      }, 100);
      updateMarkBtnState();
    });
    audio.addEventListener('pause', updateMarkBtnState);
    audio.addEventListener('ended', updateMarkBtnState);
    audio.addEventListener('timeupdate', updateMarkBtnState);


    markBtn.addEventListener('click', () => {
      if (currentBeat > 0) {
        if (!markedBeats.includes(currentBeat)) {
          markedBeats.push(currentBeat);
          markedBeats.sort((a, b) => a - b);
          renderBeatBoxes();
        }
        notif.textContent = `Beat ${currentBeat} ditandai!`;
        setTimeout(() => notif.textContent = '', 1200);
      }
    });

    // Autofocus BPM input on load
    window.onload = () => {
      bpmInput.focus();
      renderBeatBoxes();
    };
  </script>
    <footer style="margin-top:40px; color:#888; font-size:14px;">
      &copy; 2025 by danyzaky
    </footer>
</body>
</html>
